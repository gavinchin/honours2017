---
title: "Modelling the City of Melbourne Pedestrian Data"
subtitle: "Thesis Proposal"
author: "Gavin Chin, supervised by Di Cook"
date: "8 May 2016"
output:
  xaringan::moon_reader:
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

```{r setup, include=FALSE, echo = FALSE, warning=FALSE, message=FALSE}
options(htmltools.dir.version = FALSE, scipen = 100)
library(readr)
library(dplyr)
library(ggplot2)
library(ggmap)
library(knitr)
library(pander)
library(lubridate)
  ped_df <- read_csv("../data/Pedestrian_volume__updated_monthly_.csv")
      
  ped_loc <- read_csv("../data/Pedestrian_sensor_locations.csv")
  
  melb <- get_map(location=c(mean(range(ped_loc$Longitude)),
                               mean(range(ped_loc$Latitude))),
                                zoom=14)
```

class: center

# Introduction

The City of Melbourne has an Open Data Platform which makes council data available to the public  

This project will focus on the pedestrian sensor data

```{r, echo = FALSE, fig.height=5}
ggmap(melb) + geom_point(aes(x = Longitude, y = Latitude), data = ped_loc, colour = "red", alpha = 0.7) +
              labs(title = "Melbourne Pedestrian Sensor Locations") +
              xlab(NULL) + ylab(NULL) +
              theme(plot.title = element_text(hjust = 0.5), plot.caption = element_text(hjust = 0.5),
                    axis.text.x = element_blank(), axis.text.y = element_blank(),
                    axis.ticks = element_blank())
```


---

# How is the data collected?

The City of Melbourne has `r nrow(ped_loc)` sensors installed around Melbourne's CBD  
These sensors are positioned under an awning or street pole, and count the number of people passing each hour

---

# What does the data look like?

```{r}
glimpse(ped_df)
```

--

#### Basic variables available are: time and date, sensor ID and hourly counts


```{r, echo = FALSE}
      ped_df$Year <- as.factor(ped_df$Year)
      ped_df$Month <- as.factor(ped_df$Month)
      ped_df$Month <- factor(ped_df$Month, levels(ped_df$Month)[c(5,4,8,1,9,7,6,2,12,11,10,3)])
      ped_df$Time <- as.factor(ped_df$Time)
      ped_df$Timeplot <- as.integer(ped_df$Time)
      ped_df$MTime <- as.integer(ped_df$Time) + ((as.integer(ped_df$Mdate)-1) * 24)
      ped_df$Day <- as.factor(ped_df$Day)
      ped_df$Day <- factor(ped_df$Day, levels(ped_df$Day)[c(2,6,7,5,1,3,4)])

```


---

class: center, middle

## Time series at each sensor location

```{r, message= FALSE, warning= FALSE, fig.height = 5, fig.width = 12, echo = FALSE, fig.align= "center"}
bsplot <- ped_df %>% filter(Year == "2016", Month == "June", Mdate < 25, Sensor_ID == "13")
ggplot(bsplot) + geom_line(aes(x = MTime, y = Hourly_Counts)) + ggtitle("Hourly Pedestrian Count at Flagstaff Station", subtitle = "during June 2016") +
      xlab("Hour of the Month") + ylab("Hourly Counts") + theme_light()
```

---

# Why do we want to model pedestrian traffic?

### Being able to predict how many people pass through a certain location can be used by the government sector as well as the private sector  

#### Different ways it can be used: 

  Government example uses:  
    - Infrastructure planning
    - Security planning
  Private example uses:
    - Marketing campaign planning
    - Resource management
    - Investment planning
  
  and many other various ways..


---
class: inverse, middle, center

# Methodology

### The project has been split into multiple steps:  
#### Data Cleaning
#### Modelling
#### Visualisation
#### Shiny app development
  
---

# Data Cleaning: Problems in the data

### While the data variables themselves are relatively tidy, there is a large number of observations we need to impute:

--

```{r, echo = FALSE, fig.align = "center", fig.height=6, fig.width=12}
ped_plot <- aggregate(x = ped_df$Hourly_Counts,
                      by = list("Sensor_ID" = ped_df$Sensor_ID, "Year" = ped_df$Year, "Month" = ped_df$Month),
                      FUN = sum)

ped_plot$counts <- ped_plot$x


ped_plot$Time <- parse_date(paste(ped_plot$MDate, ped_plot$Month, ped_plot$Year,
                                  sep = "-"), format = "%D-%B-%Y")

ped_plot$ID <- as.integer(ped_plot$Sensor_ID)

ped_plot$Sensor_ID <- as.factor(ped_plot$Sensor_ID)

ggplot(filter(ped_plot)) + geom_line(aes(x = Time, y = counts, colour = Sensor_ID)) + theme_light() +
  theme(legend.position = "none") + labs(x = "Year", y = "Pedestrian Counts") + ggtitle("Monthly Total Counts by Sensor")

```

---

# Data Cleaning: Imputing the missings

#### A simple way to impute these missings is estimating a Poisson regression using GLM in R:

```{r, eval = FALSE, tidy = TRUE}
missing_glm <- glm(Hourly_Counts ~ Year * HDay * Time + Month)
```

This can be expressed as:

$$\text{HourlyCounts} \sim\text{Year}\times\text{HDay}\times\text{Time}+\text{Month}$$
$$\Rightarrow\qquad \log{\lambda_{i}}  =\beta_{0}+\beta_{1}\text{Year}\times\text{HDay}\times\text{Time}+\beta_{2}\text{Month}$$
$$\text{HourlyCounts}_{i}  =\text{Poisson}\left(\lambda_{i}\right)$$
